---
default_config: &defaults
  buildpacks:
    - php_buildpack
  disk_quota: 768M
  env:
    ENV: ${CIRCLE_BRANCH}
    LD_LIBRARY_PATH: /home/vcap/app/php/lib/
    PHP_INI_SCAN_DIR: /home/vcap/app/php/etc/:/home/vcap/app/php/etc/php.ini.d/
    COMPOSER_NO_DEV: 1
  timeout: 180
  routes:
    - route: vote-drupal-${CIRCLE_BRANCH}.apps.internal
      protocol: http1
  services:
    - vote-mysql-${CIRCLE_BRANCH}
    - vote-secrets-${CIRCLE_BRANCH}
    - vote-storage-${CIRCLE_BRANCH}

applications:
- name: vote-drupal-${CIRCLE_BRANCH}
  <<: *defaults
  memory: ${DRUPAL_MEMORY}
  instances: 1
  random-route: false
